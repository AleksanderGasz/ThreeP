@*@namespace ThreeP.Modules.Items

<MBox Name="Dodaj/Edytuj"  Expanded="expanded" ExpandedDisabled="true" StickyTop StickyOffsetTop="64px"  OnDoubleClick="@Add">
    <HeaderRight>
        <MudButton Disabled="addDisabled" Color="Color.Success" Variant="Variant.Filled" Size="Size.Medium" OnClick="Add">Dodaj</MudButton>
    </HeaderRight>
    <ChildContent>
        <MudForm @ref="@form" Model="Item" @bind-IsValid="@success" @bind-Errors="errors">
            <MudTextField @bind-Value="@Item?.Name" Label="Nazwa" Variant="Variant.Outlined" Required Immediate
                          Clearable/>
            <MudTextField @bind-Value="@Item?.Description" Label="Opis" Variant="Variant.Outlined" Lines="3" Clearable/>
            <MudNumericField @bind-Value="@Item?.Weight" Label="Waga" Variant="Variant.Outlined" AdornmentText="Kg"
                             Clearable/>
            <MudStack Row Justify="Justify.FlexEnd" Class="@GlobalStyles.MarginTop">
                <MudButton  Variant="Variant.Filled" Color="Color.Error" OnClick="Cancel" Class="me-3">Anuluj</MudButton>
                <MudButton Disabled="@(!form.IsValid)" Variant="Variant.Filled" Color="Color.Success" OnClick="Ok">OK
                </MudButton>
            </MudStack>
        </MudForm>
    </ChildContent>
</MBox>

@code {
    [Parameter] public EventCallback<(Item item,bool isNew)> ItemChanged { get; set; }
    [Parameter] public Item? Item { get; set; }

    string[]? errors;
    bool success;
    MudForm? form;
    Item exist = new();

     bool isNew { get; set; }
    bool expanded;
    bool addDisabled;


    protected override void OnParametersSet()
    {
        Item ??= new();
        if (!ReferenceEquals(exist, Item) && !string.IsNullOrWhiteSpace(Item.Name))
        {
            exist = Item;
            expanded = true;
            addDisabled = true;
        }
        else
        {
            Item = new();
            expanded = false;
        }
    }


    async Task Add()
    {
        addDisabled = true;
        Item = new();
        exist = Item;
        expanded = true;
        isNew = true;
    }


    async Task Ok()
    {
        exist = Item;
        await ItemChanged.InvokeAsync((Item,isNew));
        Item = new();
        expanded = false;
        addDisabled = false;
        isNew = false;
    }
    
    async Task Cancel()
    {
        expanded = false;
        addDisabled = false;
        isNew = false;
        await form.ResetAsync();
    }

}*@